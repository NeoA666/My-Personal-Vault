### 从一个C语言程序出发的内存类型分析

运行一个C语言程序时会分配两种类型的变量：一种称为栈内存，主要时用于存放一些临时变量等，在函数退出后释放内存；另一种为堆内存，用于长期保存一些数据，对它的申请和释放操作都需要由程序员显式地完成

## 内存API调用

- `malloc()`传入要申请堆空间的大小，成功就返回一个指向新空间的指针，失败就返回NULL
	一般用`sizeof()`操作符去申请正确大小的空间，也可以传入一个分配在栈上变量

- `free()`用于释放内存，内存大小由内存分配库本身记录追踪

## 一些错误

- **分配**
	- 忘记分配内存：编译发生错误
	- 忘记初始化分配的内存：可能会读取到一些随机和有害的内容
	- 没有分配足够的内存：导致缓存区溢出，大部分时候无害，并不意味着正确

- **释放**
	- 忘记释放内存：称为**内存泄露**，在长时间运行的程序中有害，会导致内存不足致使程序重新启动
	- 在用完之前释放内存：称为**悬挂指针**，指向的内容为空或者是其他什么东西
	- 重复释放内存：崩溃……
	- 无效释放：错误调用free()

## OS底层支持

使用`malloc()`和`free()`库调用时实际上是使用了系统调用brk和sbrk

### 其他调用

- `calloc()`：分配内存，并在返回之前置零，可以避免忘记初始化内存的错误
- `realloc()`：可以创建一个更大的内存空间，复制旧内容，并返回新区域的指针

