# ç°ä»£ Rust é¡¹ç›®å¼€å‘æŒ‡å—ï¼šæ„å»ºæ¸…æ™°ã€å¯ç»´æŠ¤çš„ç³»ç»Ÿ

æœ¬æŒ‡å—éµå¾ª "å…³æ³¨ç‚¹åˆ†ç¦»"ï¼ˆSeparation of Concernsï¼‰å’Œ "é›¶æˆæœ¬æŠ½è±¡"ï¼ˆZero-Cost Abstractionsï¼‰çš„æ ¸å¿ƒç†å¿µï¼Œæ—¨åœ¨è§£å†³ä»£ç è‡ƒè‚¿ã€è€¦åˆåº¦é«˜å’Œé”™è¯¯å¤„ç†æ··ä¹±ç­‰å¸¸è§é—®é¢˜ã€‚

## 1. é¡¹ç›®ç»“æ„ä¸æ¨¡å—åŒ– (Project Structure & Modularity)

Rust çš„æ¨¡å—ç³»ç»Ÿæ˜¯ç»„ç»‡ä»£ç çš„ç¬¬ä¸€é“é˜²çº¿ã€‚ä¸è¦æŠŠæ‰€æœ‰ä»£ç éƒ½å¡è¿›Â `main.rs`Â æˆ–Â `lib.rs`ã€‚

### 1.1 äºŒè¿›åˆ¶é¡¹ç›® vs åº“é¡¹ç›®

å³ä½¿ä½ å¼€å‘çš„æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰ï¼Œä¹Ÿå»ºè®®é‡‡ç”¨Â **Library-First**ï¼ˆåº“ä¼˜å…ˆï¼‰çš„ç­–ç•¥ã€‚

- **`src/lib.rs`**: åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚ä»»ä½•å¯ä»¥é€šè¿‡ä»£ç è°ƒç”¨çš„åŠŸèƒ½éƒ½åº”æ”¾åœ¨è¿™é‡Œã€‚
- **`src/main.rs`**: ä»…åŒ…å«å…¥å£ç‚¹ã€å‚æ•°è§£æï¼ˆCLI parsingï¼‰å’Œé¡¶å±‚èƒ¶æ°´ä»£ç ã€‚å®ƒåº”è¯¥åªæ˜¯Â `lib.rs`Â çš„æ¶ˆè´¹è€…ã€‚
- **`src/bin/`**: å¦‚æœä½ çš„é¡¹ç›®åŒ…å«å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾åœ¨è¿™é‡Œã€‚

**æ¨èç›®å½•ç»“æ„ï¼š**

Text

```
my_project/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs          # æç®€å…¥å£ï¼Œè´Ÿè´£å¯åŠ¨
â”‚   â”œâ”€â”€ lib.rs           # æ¨¡å—å¯¼å‡ºä¸­å¿ƒ
â”‚   â”œâ”€â”€ config.rs        # é…ç½®åŠ è½½
â”‚   â”œâ”€â”€ error.rs         # ç»Ÿä¸€é”™è¯¯å®šä¹‰
â”‚   â”œâ”€â”€ domain/          # çº¯ä¸šåŠ¡é¢†åŸŸé€»è¾‘ (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ models.rs    # æ ¸å¿ƒæ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡æµç¨‹ç¼–æ’
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ user_service.rs
â”‚   â””â”€â”€ adapters/        # ä¸å¤–éƒ¨ä¸–ç•Œçš„äº¤äº’ (æ•°æ®åº“, HTTP, æ–‡ä»¶)
â”‚       â”œâ”€â”€ mod.rs
â”‚       â”œâ”€â”€ db.rs
â”‚       â””â”€â”€ http_client.rs
â””â”€â”€ tests/               # é›†æˆæµ‹è¯•
    â””â”€â”€ integration_test.rs
```

### 1.2 ä¸šåŠ¡é€»è¾‘ä¸ä¸»å‡½æ•°åˆ†ç¦»

`main.rs`Â åº”è¯¥å°½å¯èƒ½çŸ­å°ï¼Œä¸»è¦è´Ÿè´£å¤„ç†Â `Result`Â å¹¶å†³å®šç¨‹åºçš„é€€å‡ºç ã€‚

**âŒ é”™è¯¯ç¤ºèŒƒ (main.rs):**

Rust

```
fn main() {
    // å¤æ‚çš„å‚æ•°è§£æ...
    // æ•°æ®åº“è¿æ¥é€»è¾‘...
    // æ ¸å¿ƒä¸šåŠ¡å¾ªç¯...
    // é”™è¯¯æ‰“å°...
}
```

**âœ… æ­£ç¡®ç¤ºèŒƒ (main.rs):**

Rust

```
use my_project::{run, Config};

fn main() {
    // 1. ä»…å¤„ç†ç¯å¢ƒ/é…ç½®åˆå§‹åŒ–
    let config = Config::from_env().unwrap_or_else(|err| {
        eprintln!("é…ç½®åŠ è½½å¤±è´¥: {}", err);
        std::process::exit(1);
    });

    // 2. å°†æ§åˆ¶æƒç§»äº¤ç»™ lib
    if let Err(e) = run(config) {
        eprintln!("åº”ç”¨ç¨‹åºé”™è¯¯: {}", e);
        std::process::exit(1);
    }
}
```

---

## 2. æ•°æ®ç»“æ„ç»„ç»‡ (Struct Organization)

Rust ä¸­æ•°æ®çš„å½¢çŠ¶å†³å®šäº†ä»£ç çš„ç»“æ„ã€‚ä¸ºäº†é¿å…â€œä¸Šå¸å¯¹è±¡â€ï¼ˆGod Objectsï¼‰å’Œè¿‡åº¦è€¦åˆï¼Œåº”æ ¹æ®**ç”¨é€”**åˆ†ç¦»æ•°æ®æ¨¡å‹ã€‚

### 2.1 é¢†åŸŸæ¨¡å‹ vs æ•°æ®ä¼ è¾“å¯¹è±¡ (DTO)

ä¸è¦åœ¨æ•°æ®åº“å±‚ã€API å±‚å’Œä¸šåŠ¡é€»è¾‘å±‚ä½¿ç”¨åŒä¸€ä¸ª Structã€‚è¿™ä¼šå¯¼è‡´ Struct å……æ»¡äº†Â `Option`Â å­—æ®µæˆ–è€…ä¸å¿…è¦çš„ Serde æ ‡è®°ã€‚

1. **Domain Models (é¢†åŸŸæ¨¡å‹)**: ä½äºÂ `src/domain/models.rs`ã€‚
    
    - ä»£è¡¨ä¸šåŠ¡æ ¸å¿ƒå®ä½“ã€‚
    - å­—æ®µç±»å‹ä¸¥æ ¼ï¼ˆä¾‹å¦‚ä½¿ç”¨Â `u32`Â è€Œä¸æ˜¯Â `i32`Â å¦‚æœä¸èƒ½ä¸ºè´Ÿï¼‰ã€‚
    - **ä¸åº”è¯¥**Â åŒ…å«æ•°æ®åº“ç‰¹å®šçš„å®ï¼ˆå¦‚ SQLx çš„å®ï¼‰æˆ– HTTP åºåˆ—åŒ–å®ï¼Œé™¤éè¯¥æ¨¡å‹æå…¶ç®€å•ã€‚
2. **DTOs (Data Transfer Objects)**: é€šå¸¸ä½äº API æ¥å£å±‚æˆ–æ•°æ®åº“é€‚é…å±‚ã€‚
    
    - **Request DTO**:ç”¨äºæ¥æ”¶å¤–éƒ¨è¾“å…¥ï¼ˆé€šå¸¸å…¨æ˜¯Â `Option`Â æˆ–Â `String`ï¼Œéœ€è¦æ ¡éªŒï¼‰ã€‚
    - **Response DTO**: ç”¨äºæ ¼å¼åŒ–è¾“å‡ºç»™å‰ç«¯ã€‚
    - **Entity DTO**: ç›´æ¥å¯¹åº”æ•°æ®åº“è¡¨ç»“æ„ã€‚

**ç¤ºä¾‹ï¼š**

Rust

```
// domain/user.rs (æ ¸å¿ƒä¸šåŠ¡å¯¹è±¡)
pub struct User {
    pub id: UserId,
    pub email: String,
    pub status: UserStatus,
}

// adapters/http/requests.rs (è¾“å…¥å¯¹è±¡)
#[derive(Deserialize)]
pub struct CreateUserRequest {
    pub email: String, // åŸå§‹å­—ç¬¦ä¸²ï¼Œå°šæœªéªŒè¯
    pub password: String,
}

// å®ç° From trait è¿›è¡Œè½¬æ¢æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯
impl TryFrom<CreateUserRequest> for User { ... }
```

### 2.2 ä½¿ç”¨ New Type Pattern (æ–°ç±»å‹æ¨¡å¼)

é¿å…â€œåŸºæœ¬ç±»å‹åæ‰§â€ï¼ˆPrimitive Obsessionï¼‰ã€‚å¦‚æœä¸€ä¸ªÂ `String`Â ä»£è¡¨çš„æ˜¯ Emailï¼Œå°±ä¸è¦æŠŠå®ƒä»…ä»…å½“ä½œÂ `String`Â å¤„ç†ã€‚

Rust

```
// âœ… è¿™æ ·åšä½¿å¾—ç¼–è¯‘å™¨èƒ½å¸®ä½ æ£€æŸ¥é€»è¾‘é”™è¯¯
pub struct UserId(pub uuid::Uuid);
pub struct Email(String);

impl Email {
    pub fn new(s: String) -> Result<Self, ValidationError> {
        // åœ¨è¿™é‡Œè¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿ Email å®ä¾‹æ°¸è¿œæ˜¯åˆæ³•çš„
        if !s.contains('@') { return Err(...); }
        Ok(Self(s))
    }
}
```

---

## 3. é”™è¯¯å¤„ç† (Error Handling)

é”™è¯¯å¤„ç†æ˜¯ Rust ä»£ç æ˜¯å¦â€œæ¸…æ™°â€çš„åˆ†æ°´å²­ã€‚ä¸è¦åœ¨åº“ä»£ç ä¸­åˆ°å¤„Â `panic!`Â æˆ–Â `unwrap`ã€‚

### 3.1 å®šä¹‰ç»Ÿä¸€çš„é”™è¯¯ç±»å‹

ä½¿ç”¨Â `thiserror`Â åº“æ¥å®šä¹‰åº“çº§åˆ«çš„é”™è¯¯æšä¸¾ã€‚è¿™æ¯”æ‰‹å†™Â `std::fmt::Display`Â è¦å¹²å‡€å¾—å¤šã€‚

**`src/error.rs`:**

Rust

```
use thiserror::Error;

#[derive(Error, Debug)]
pub enum AppError {
    #[error("é…ç½®é”™è¯¯: {0}")]
    ConfigError(#[from] config::ConfigError),

    #[error("æ•°æ®åº“é”™è¯¯: {0}")]
    DatabaseError(#[from] sqlx::Error),

    #[error("ä¸šåŠ¡é€»è¾‘é”™è¯¯: {0}")]
    DomainError(String),
    
    #[error("æœªæ‰¾åˆ°èµ„æº: {0}")]
    NotFound(String),
}

// å®šä¹‰ä¸€ä¸ªé€šç”¨çš„ Result ç±»å‹åˆ«å
pub type Result<T> = std::result::Result<T, AppError>;
```

### 3.2 é”™è¯¯çš„å†’æ³¡ä¸ä¸Šä¸‹æ–‡

ä½¿ç”¨Â `anyhow`Â åº“ï¼ˆé€šå¸¸ç”¨äºÂ `main.rs`Â æˆ–äºŒè¿›åˆ¶å…¥å£ï¼‰æ¥æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œè€Œåœ¨åº“å†…éƒ¨ï¼ˆ`lib.rs`Â åŠå…¶å­æ¨¡å—ï¼‰åšæŒä½¿ç”¨å…·ä½“çš„Â `thiserror`Â å®šä¹‰çš„é”™è¯¯ã€‚

**âœ… åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ (lib):**

Rust

```
pub fn create_user(email: &str) -> Result<User> {
    if email_exists(email)? { // ? è‡ªåŠ¨è½¬æ¢é”™è¯¯ç±»å‹
        return Err(AppError::DomainError("Email already exists".into()));
    }
    // ...
}
```

**âœ… åœ¨åº”ç”¨å…¥å£ä¸­ (bin):**

Rust

```
// ä½¿ç”¨ anyhow ä¸ºé”™è¯¯æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œæ–¹ä¾¿è°ƒè¯•
context("æ— æ³•è¿æ¥åˆ°ä¸»æ•°æ®åº“")?
```

---

## 4. ä¾èµ–æ³¨å…¥ä¸å¯æµ‹è¯•æ€§ (Dependency Injection)

ä¸ºäº†é¿å…ä»£ç è‡ƒè‚¿ä¸”éš¾ä»¥æµ‹è¯•ï¼Œä¸è¦åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ç¡¬ç¼–ç å…·ä½“çš„å®ç°ï¼ˆå¦‚å…·ä½“çš„æ•°æ®åº“è¿æ¥ï¼‰ã€‚ä½¿ç”¨Â **Trait**Â æ¥å®šä¹‰è¡Œä¸ºã€‚

### 4.1 å®šä¹‰ Port (æ¥å£)

åœ¨ä¸šåŠ¡å±‚å®šä¹‰ä½ éœ€è¦ä»€ä¹ˆï¼Œè€Œä¸æ˜¯ä½ æ€ä¹ˆåšã€‚

Rust

```
// src/domain/repository.rs
use async_trait::async_trait;
use crate::domain::models::User;

#[async_trait]
pub trait UserRepository: Send + Sync {
    async fn save(&self, user: &User) -> Result<()>;
    async fn find_by_email(&self, email: &str) -> Result<Option<User>>;
}
```

### 4.2 å®ç° Adapter (é€‚é…å™¨)

åœ¨åŸºç¡€è®¾æ–½å±‚å®ç°è¿™äº› Traitã€‚

Rust

```
// src/adapters/postgres_repo.rs
pub struct PostgresUserRepository {
    pool: sqlx::PgPool,
}

#[async_trait]
impl UserRepository for PostgresUserRepository {
    // å…·ä½“å®ç°...
}
```

### 4.3 åœ¨ Service ä¸­ä½¿ç”¨æ³›å‹æˆ–åŠ¨æ€åˆ†å‘

è¿™ä½¿å¾—ä½ å¯ä»¥è½»æ¾åœ°åœ¨æµ‹è¯•ä¸­æ›¿æ¢ä¸º Mock å¯¹è±¡ã€‚

Rust

```
// src/services/user_service.rs
pub struct UserService<R: UserRepository> {
    repo: R,
}

impl<R: UserRepository> UserService<R> {
    pub fn new(repo: R) -> Self { Self { repo } }

    pub async fn register(&self, email: &str) -> Result<()> {
        // è¿™é‡Œçš„é€»è¾‘ä¸ä¾èµ–å…·ä½“çš„æ•°æ®åº“ï¼Œåªä¾èµ– Trait
        if self.repo.find_by_email(email).await?.is_some() {
           return Err(AppError::DomainError("Exists".into()));
        }
        // ...
    }
}
```

---

## 5. ä¿æŒä»£ç ç®€æ´çš„å®ç”¨æŠ€å·§

1. **Clippy æ˜¯ä½ çš„è‰¯å¸ˆç›Šå‹**: åœ¨ CI/CD ä¸­å¼ºåˆ¶è¿è¡ŒÂ `cargo clippy -- -D warnings`ã€‚å®ƒèƒ½æ•æ‰åˆ°è®¸å¤šéæƒ¯ç”¨çš„å†™æ³•ã€‚
    
2. **ä½¿ç”¨ Builder æ¨¡å¼**: å¯¹äºé…ç½®é¡¹å¤šã€å¯é€‰å‚æ•°å¤šçš„ç»“æ„ä½“ï¼Œä½¿ç”¨Â `derive_builder`Â æˆ–æ‰‹å†™ Builder æ¨¡å¼ï¼Œè€Œä¸æ˜¯å†™ä¸€ä¸ªå¸¦æœ‰ 10 ä¸ªå‚æ•°çš„Â `new`Â å‡½æ•°ã€‚
    
3. **é¿å…è¿‡åº¦å¤æ‚çš„ç”Ÿå‘½å‘¨æœŸ**: å¦‚æœç”Ÿå‘½å‘¨æœŸæ ‡è®°è®©ä½ å¤´ç–¼ä¸”å¹¶éæ€§èƒ½çƒ­ç‚¹ï¼Œç›´æ¥ä½¿ç”¨Â `.clone()`Â æˆ–Â `Rc`/`Arc`ã€‚ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§é€šå¸¸ä¼˜å…ˆäºå¾®å°çš„æ€§èƒ½ä¼˜åŒ–ã€‚
    
4. **æ—©æœŸè¿”å› (Guard Clauses)**: å‡å°‘åµŒå¥—å±‚çº§ã€‚
    
    Rust
    
    ```
    // âŒ åµŒå¥—åœ°ç‹±
    if let Some(x) = val {
        if x > 10 {
            // do something
        }
    }
    
    // âœ… æ—©æœŸè¿”å›
    let Some(x) = val else { return Ok(()); };
    if x <= 10 { return Ok(()); }
    // do something
    ```
    

## æ€»ç»“

éµå¾ªæ­¤æŒ‡å—ï¼Œä½ å°†è·å¾—ä¸€ä¸ªï¼š

- **ä¸è‡ƒè‚¿**ï¼šå› ä¸ºèŒè´£æ¸…æ™°ï¼Œæ²¡æœ‰å·¨å‹æ–‡ä»¶ã€‚
- **æ˜“ç»´æŠ¤**ï¼šå› ä¸ºæ•°æ®æ¨¡å‹åˆ†ç¦»ï¼Œä¿®æ”¹æ•°æ®åº“å±‚ä¸ä¼šç ´åæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚
- **é²æ£’**ï¼šå› ä¸ºä½¿ç”¨äº†ç±»å‹ç³»ç»Ÿï¼ˆNew Typeï¼‰å’Œç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç­–ç•¥ã€‚
![[Pasted image 20251204214135.png]]

**è¿™æ ·çš„ä»£ç çš„æ¨¡å—è¯ç¨‹åº¦ä¸é«˜ï¼Œä½“ç°åœ¨å‡½æ•°åŠŸèƒ½æœªä»ä¸»å‡½æ•°éƒ¨åˆ†åˆ†ç¦»ä»¥åŠå˜é‡æ²¡æœ‰æŒ‰ç…§ä½¿ç”¨ç›®çš„æ¥åˆ†ç±»ï¼›åŒæ—¶ï¼Œé”™è¯¯å¤„ç†èƒ½åŠ›ä¹Ÿä¸å¼ºï¼Œå¯¹äºæ–‡ä»¶è¯»å–å¤±è´¥ä¸èƒ½è¾“å‡ºè¯¦ç»†çš„æŠ¥é”™åŸå› ï¼Œé”™è¯¯å¤„ç†çš„ä¸šåŠ¡é€»è¾‘ä¸å¤Ÿé›†ä¸­**

# æµ‹è¯•é©±åŠ¨å¼€å‘ (TDD) ç®€è¦æŒ‡å—

> **æ ¸å¿ƒç†å¿µ**ï¼šå…ˆå†™æµ‹è¯•ï¼Œå†å†™ä»£ç ã€‚(Red -> Green -> Refactor)

## 1. TDD çš„æ ¸å¿ƒå¾ªç¯ (Red-Green-Refactor)

TDD çš„å¼€å‘è¿‡ç¨‹éµå¾ªä¸€ä¸ªçŸ­å‘¨æœŸçš„å¾®å¾ªç¯ï¼Œé€šå¸¸è¢«ç§°ä¸º "çº¢-ç»¿-é‡æ„"ï¼š

1.  ğŸ”´ **çº¢ (Red) - ç¼–å†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•**
    *   æ ¹æ®éœ€æ±‚ï¼Œç¼–å†™ä¸€ä¸ªæœ€å°å•å…ƒçš„æµ‹è¯•ç”¨ä¾‹ã€‚
    *   è¿è¡Œæµ‹è¯•ï¼Œç¡®è®¤å®ƒ**å¤±è´¥**ï¼ˆå¦‚æœç¼–è¯‘å¤±è´¥ä¹Ÿç®—å¤±è´¥ï¼‰ã€‚
    *   *ç›®çš„ï¼šæ˜ç¡®éœ€æ±‚ï¼Œç¡®ä¿æµ‹è¯•æœ‰æ•ˆã€‚*

2.  ğŸŸ¢ **ç»¿ (Green) - è®©æµ‹è¯•é€šè¿‡**
    *   ç¼–å†™**åˆšå¥½è¶³å¤Ÿ**çš„ç”Ÿäº§ä»£ç æ¥è®©æµ‹è¯•é€šè¿‡ã€‚
    *   ä¸è¦è€ƒè™‘ä»£ç ä¼˜é›…æ€§ï¼Œç”šè‡³å¯ä»¥æ˜¯ç¡¬ç¼–ç ï¼ˆHardcodingï¼‰ã€‚
    *   *ç›®çš„ï¼šå¿«é€Ÿè·å¾—åé¦ˆï¼Œç¡®è®¤åŠŸèƒ½å®ç°ã€‚*

3.  ğŸ”µ **é‡æ„ (Refactor) - ä¼˜åŒ–ä»£ç **
    *   åœ¨ä¿æŒæµ‹è¯•é€šè¿‡çš„å‰æä¸‹ï¼Œä¼˜åŒ–ä»£ç ç»“æ„ã€æ¶ˆé™¤é‡å¤ã€æå‡å¯è¯»æ€§ã€‚
    *   æ—¢è¦é‡æ„ç”Ÿäº§ä»£ç ï¼Œä¹Ÿè¦é‡æ„æµ‹è¯•ä»£ç ã€‚
    *   *ç›®çš„ï¼šä¿æŒä»£ç æ•´æ´ï¼Œé™ä½æŠ€æœ¯å€ºåŠ¡ã€‚*

---

## 2. TDD çš„ä¸‰æ¡å†›è§„ (Uncle Bob)

1.  **é™¤éæ˜¯ä¸ºäº†è®©ä¸€ä¸ªå¤±è´¥çš„ unit test é€šè¿‡ï¼Œå¦åˆ™ä¸å…è®¸ç¼–å†™ä»»ä½•ç”Ÿäº§ä»£ç ã€‚**
2.  **åªå…è®¸ç¼–å†™åˆšå¥½èƒ½å¤Ÿå¯¼è‡´å¤±è´¥çš„ unit testï¼ˆç¼–è¯‘å¤±è´¥ä¹Ÿç®—å¤±è´¥ï¼‰ã€‚**
3.  **åªå…è®¸ç¼–å†™åˆšå¥½èƒ½å¤Ÿè®©å¤±è´¥çš„ unit test é€šè¿‡çš„ç”Ÿäº§ä»£ç ã€‚**

---

## 3. å®æˆ˜ç¤ºä¾‹ (Python)

å‡è®¾æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨åŠ æ³•åŠŸèƒ½ã€‚

### ç¬¬ä¸€æ­¥ï¼šğŸ”´ çº¢ (Red)
ç¼–å†™æµ‹è¯•ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°æˆ–æ–­è¨€ä¸€ä¸ªæœªå®ç°çš„è¡Œä¸ºã€‚

```python
# test_calculator.py
import calculator

def test_add_two_numbers():
    # æˆ‘ä»¬æœŸæœ› add(1, 2) è¿”å› 3
    assert calculator.add(1, 2) == 3
```
*çŠ¶æ€ï¼šè¿è¡Œå¤±è´¥ï¼ˆå› ä¸º `calculator` æ¨¡å—æˆ– `add` å‡½æ•°ä¸å­˜åœ¨ï¼‰ã€‚*

### ç¬¬äºŒæ­¥ï¼šğŸŸ¢ ç»¿ (Green)
ç”¨æœ€å¿«çš„æ–¹å¼è®©å®ƒé€šè¿‡ã€‚

```python
# calculator.py
def add(a, b):
    return 3  # ç”šè‡³å¯ä»¥ç”¨è¿™ç§"ä½œå¼Š"çš„æ–¹å¼å…ˆé€šè¿‡æµ‹è¯•ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿­ä»£
    # æˆ–è€…ç›´æ¥å†™ return a + b
```
*çŠ¶æ€ï¼šè¿è¡ŒæˆåŠŸã€‚*

### ç¬¬ä¸‰æ­¥ï¼šğŸ”µ é‡æ„ (Refactor)
å¦‚æœæˆ‘ä»¬ä¹‹å‰å†™çš„æ˜¯ `return 3`ï¼Œç°åœ¨éœ€è¦åŠ å…¥æ–°çš„æµ‹è¯•ç”¨ä¾‹è¿«ä½¿æˆ‘ä»¬å†™å‡ºé€šç”¨é€»è¾‘ï¼Œç„¶åé‡æ„ä»£ç ä½¿å…¶æ­£ç¡®ã€‚

```python
# calculator.py (Refactored)
def add(a, b):
    return a + b
```

---

## 4. TDD çš„æ”¶ç›Šä¸æˆæœ¬

| æ”¶ç›Š (Pros) | æˆæœ¬ (Cons) |
| :--- | :--- |
| **é«˜è´¨é‡ä»£ç **ï¼šå¤©ç„¶çš„é«˜è¦†ç›–ç‡ï¼ŒBug æ›´å°‘ã€‚ | **åˆæœŸé€Ÿåº¦æ…¢**ï¼šåˆšå¼€å§‹å­¦ä¹ å’Œç¼–å†™æ—¶æ„Ÿè§‰æ•ˆç‡é™ä½ã€‚ |
| **æ´»æ–‡æ¡£**ï¼šæµ‹è¯•ç”¨ä¾‹å°±æ˜¯æœ€å¥½çš„åŠŸèƒ½è¯´æ˜ä¹¦ã€‚ | **ç»´æŠ¤æˆæœ¬**ï¼šéœ€æ±‚å˜æ›´æ—¶ï¼Œéœ€è¦åŒæ—¶ç»´æŠ¤æµ‹è¯•å’Œä»£ç ã€‚ |
| **è®¾è®¡è¾…åŠ©**ï¼šè¿«ä½¿ä½ å†™å‡ºè§£è€¦çš„ã€å¯æµ‹è¯•çš„ä»£ç ã€‚ | **å­¦ä¹ æ›²çº¿**ï¼šéœ€è¦æ”¹å˜ç¼–ç¨‹æ€ç»´ï¼ŒæŒæ¡ Mock/Stub ç­‰æŠ€å·§ã€‚ |
| **é‡æ„ä¿¡å¿ƒ**ï¼šä¿®æ”¹ä»£ç æ—¶ä¸å†å®³æ€•ç ´åç°æœ‰åŠŸèƒ½ã€‚ | |

## 5. æœ€ä½³å®è·µ Tips

*   **æµ‹è¯•å‘½åè¦æ¸…æ™°**ï¼šä¾‹å¦‚ `should_return_true_when_input_is_valid`ï¼Œè®©çœ‹æµ‹è¯•çš„äººä¸€çœ¼æ˜ç™½ä¸šåŠ¡æ„å›¾ã€‚
*   **ä¿æŒæµ‹è¯•ç‹¬ç«‹**ï¼šæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸åº”ä¾èµ–å…¶ä»–æµ‹è¯•çš„è¿è¡Œé¡ºåºæˆ–çŠ¶æ€ã€‚
*   **å•å…ƒæµ‹è¯•è¦å¿«**ï¼šTDD ä¾èµ–é¢‘ç¹è¿è¡Œæµ‹è¯•ï¼Œå¦‚æœæµ‹è¯•è·‘å¾—æ…¢ï¼Œå°±ä¼šç ´åå¿ƒæµã€‚
*   **å…ˆæ–­è¨€ (Assert First)**ï¼šå†™æµ‹è¯•æ—¶ï¼Œå…ˆå†™ `Assert` è¯­å¥ï¼Œå†åæ¨éœ€è¦ä»€ä¹ˆè¾“å…¥ã€‚

**åˆ©ç”¨`eprintln!()`å°†é”™è¯¯æç¤ºä¿¡æ¯æ‰“å°åˆ°ç»ˆç«¯ï¼Œåœ¨ç»ˆç«¯ä¸­ä½¿ç”¨`>`è¿ç®—ç¬¦å°†è¾“å‡ºå®šå‘åˆ°æŒ‡å®šæ–‡ä»¶ä¸­**

![[Pasted image 20251205205341.png]]

![[Pasted image 20251205205411.png]]